!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("ext-messenger",[],n):"object"==typeof exports?exports["ext-messenger"]=n():e["ext-messenger"]=n()}(this,function(){return function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";var o=t(1),r=t(6),s=t(2),i=t(5),a=function(){s.constructorTweakMethods("Messenger",this),this._myExtPart=s.getCurrentExtensionPart()};a.prototype.constructor=a,a.isMessengerPort=function(e){return 0===e.name.indexOf(i.MESSENGER_PORT_NAME_PREFIX)},a.prototype.initBackgroundHub=function(e){return this._myExtPart!==i.BACKGROUND?void s.log("warn","[Messenger:initBackgroundHub]","Ignoring BackgroundHub init request since not called from background context"):this._backgroundHub?void s.log("warn","[Messenger:initBackgroundHub]","Ignoring BackgroundHub init request since it is already been inited"):void(this._backgroundHub=new o(e))},a.prototype.initConnection=function(e,n){return e||s.log("error","[Messenger:initConnection]",'Missing "name" in arguments'),e===i.TO_NAME_WILDCARD&&s.log("error","[Messenger:initConnection]",'"*" is reserved as a wildcard identifier, please use another name'),new r(this._myExtPart,e,n)},e.exports=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(2),r=t(5),s=1,i=function(e){o.constructorTweakMethods("BackgroundHub",this),e=e||{},this._connectedHandler=e.connectedHandler,this._disconnectedHandler=e.disconnectedHandler,this._backgroundPorts={},this._contentScriptPorts={},this._popupPorts={},this._devtoolPorts={},chrome.runtime.onConnect.addListener(this._onPortConnected),window.mockPortOnConnect=this._onPortConnected};i.prototype.constructor=i,i.prototype._onPortConnected=function(e){o.log("log","[BackgroundHub:runtime.onConnect]",arguments),0===e.name.indexOf(r.MESSENGER_PORT_NAME_PREFIX)&&(e.onMessage.addListener(this._onPortMessageHandler),e.onDisconnect.addListener(this._onPortDisconnectionHandler))},i.prototype._onPortMessageHandler=function(e,n){switch(e.type){case r.INIT:this._initConnection(e,n);break;case r.MESSAGE:case r.RESPONSE:e.to||o.log("error","[BackgroundHub:_onPortMessageHandler]",'Missing "to" in message:',e),e.toNames||o.log("error","[BackgroundHub:_onPortMessageHandler]",'Missing "toNames" in message:',e),this._relayMessage(e,n);break;default:o.log("error","[BackgroundHub:_onPortMessageHandler]","Unknown message type: "+e.type)}},i.prototype._getPortsObj=function(e){switch(e){case r.BACKGROUND:return this._backgroundPorts;case r.CONTENT_SCRIPT:return this._contentScriptPorts;case r.POPUP:return this._popupPorts;case r.DEVTOOL:return this._devtoolPorts;default:o.log("error","[BackgroundHub:_onPortDisconnectionHandler]","Unknown extension part: "+e)}},i.prototype._initConnection=function(e,n){var t=function(e,t){var s=this._getPortsObj(e);if(s[t]=s[t]?s[t]:[],s[t].push(n),this._connectedHandler){var i=e!==r.BACKGROUND?t:null,a=o.removeMessengerPortNamePrefix(n.name);this._connectedHandler(e,a,i)}n.postMessage({from:r.BACKGROUND,type:r.INIT_SUCCESS})}.bind(this);if(e.from===r.BACKGROUND)t(r.BACKGROUND,s);else if(e.from===r.DEVTOOL)t(r.DEVTOOL,e.tabId);else if(e.from===r.CONTENT_SCRIPT)t(r.CONTENT_SCRIPT,n.sender.tab.id);else{if(e.from!==r.POPUP)throw new Error('Unknown "from" in message: '+e.from);t(r.POPUP,e.tabId)}},i.prototype._relayMessage=function(e,n){var t=e.from,i=e.to,a=e.toNames,c=e.toTabId,u=void 0;t===r.BACKGROUND?i!==r.BACKGROUND&&(u=c):t===r.DEVTOOL?u=e.tabId:t===r.POPUP?u=e.tabId:t===r.CONTENT_SCRIPT?u=n.sender.tab.id:o.log("error","[BackgroundHub:_relayMessage]",'Unknown "from" in message: '+t),e.fromTabId=u;var d=void 0;i===r.BACKGROUND?d=this._backgroundPorts[s]?this._backgroundPorts[s]:[]:i===r.DEVTOOL?d=this._devtoolPorts[u]?this._devtoolPorts[u]:[]:i===r.POPUP?d=this._popupPorts[u]?this._popupPorts[u]:[]:i===r.CONTENT_SCRIPT?d=this._contentScriptPorts[u]?this._contentScriptPorts[u]:[]:o.log("error","[BackgroundHub:_relayMessage]",'Unknown "to" in message: '+i),0===d.length&&o.log("info","[BackgroundHub:_relayMessage]",'Not sending relay because "to" port does not exist');var l=[];a.forEach(function(e){var n=d.filter(function(n){return n.name===e||e===r.TO_NAME_WILDCARD});n.length>0?n.forEach(function(e){l.indexOf(e)===-1&&l.push(e)}):o.log("warn","[BackgroundHub:_relayMessage]","Could not find any connections with this name (probably no such name):",o.removeMessengerPortNamePrefix(e))}.bind(this)),e.fromPortSender=n.sender,l.forEach(function(n){n.postMessage(e)}.bind(this))},i.prototype._onPortDisconnectionHandler=function(e){e.onMessage.removeListener(this._onPortMessageHandler);var n=function(e,n){for(var t=this._getPortsObj(e),s=Object.keys(t),i=0;i<s.length;i++){for(var a=s[i],c=t[a],u=c.length,d=u;d>=0;d--){var l=c[d];if(l===n&&(o.log("log","[BackgroundHub:_onPortDisconnectionHandler]","Remove connection of port with unique id: ",a),c.splice(d,1),this._disconnectedHandler)){var p=e!==r.BACKGROUND?parseInt(a):null,f=o.removeMessengerPortNamePrefix(n.name);this._disconnectedHandler(e,f,p)}}0===t[a].length&&(o.log("log","[BackgroundHub:_onPortDisconnectionHandler]","Removing empty ports object for unique id: ",a),delete t[a])}}.bind(this);n(r.BACKGROUND,e),n(r.CONTENT_SCRIPT,e),n(r.POPUP,e),n(r.DEVTOOL,e)},n.default=i,e.exports=n.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(3),r=t(5),s=new o({prefix:"messenger-log",markdown:!1}),i=new o({prefix:"messenger-info",markdown:!1}),a=new o({prefix:"messenger-warn",markdown:!1}),c=new o({prefix:"messenger-error",markdown:!1});o.disable("messenger*","-messenger-error","-messenger-warn");var u={log:function(e){var n=Array.prototype.slice.call(arguments,1);switch(e){case"log":s.log.apply(s,n);break;case"info":i.info.apply(i,n);break;case"warn":a.warn.apply(a,n);break;case"error":throw c.error.apply(c,n),"Messenger error occurred, check more information above...";default:c.error("Unknown log level: "+e)}},constructorTweakMethods:function(e,n){var t=function(t){var o=n[t];n[t]=function(){return s.log("["+e+":"+t+"()]",arguments),o.apply(n,arguments)}.bind(n)};for(var o in n)"function"==typeof n[o]&&t(o)},getCurrentExtensionPart:function(){var e=void 0;if("undefined"!=typeof chrome)if(chrome.devtools)e=r.DEVTOOL;else if(chrome.extension&&"function"==typeof chrome.extension.getBackgroundPage){var n=chrome.extension.getBackgroundPage();e=n===window?r.BACKGROUND:r.POPUP}else e=r.CONTENT_SCRIPT;else c.error("Could not identify extension part... are you running in a chrome extension context?");return s.log("detected current extension part: "+e),e},removeMessengerPortNamePrefix:function(e){return e.replace(new RegExp("^"+r.MESSENGER_PORT_NAME_PREFIX),"")}};n.default=u,e.exports=n.default},function(e,n,t){(function(n){!function(){"use strict";function t(e,n){return this instanceof t?(this.opts=o(e,n),p(this.opts.prefix,t._instances)?f(this.opts.prefix,t._instances):(t._instances.push(this),r(t._instances),s(),this)):new t(e,n)}function o(e,n){"object"==typeof e&&(n=e),n=n||{},"string"!=typeof e&&(e=n.prefix||""),e=g(e);var t,o=Boolean(n.alignOutput),r=void 0===n.markdown||Boolean(n.markdown);return m()?(t=P[b%P.length],b+=1):_()&&(t=M()),{prefix:e,alignOutput:o,markdown:r,prefixColor:t}}function r(e){var n=e.sort(function(e,n){return n.opts.prefix.length-e.opts.prefix.length})[0];e.forEach(function(e){if(e.opts.alignOutput){var t=new Array(Math.max(n.opts.prefix.length-e.opts.prefix.length+1,0)).join(" ");e.opts.prefix=e.opts.prefix+t}})}function s(){if(_()){var e=null;"undefined"!=typeof n&&void 0!==n.env&&(void 0!==n.env.NODE_DEBUG&&""!==n.env.NODE_DEBUG?e="NODE_DEBUG":void 0!==n.env.DEBUG&&""!==n.env.DEBUG&&(e="DEBUG"),e&&(t.disable("*"),n.env[e].split(",").forEach(function(e){t.enable(e)})))}else m()&&window.localStorage&&"string"==typeof window.localStorage.getItem("debug")&&(t.disable("*"),window.localStorage.debug.split(",").forEach(function(e){t.enable(e)}))}function i(e){for(var n=[],t=a(e);t;)e=e.replace(t.rule.regexp,t.rule.replacer),m()&&(n.push(t.rule.style),n.push("")),t=a(e);return{text:e,styles:n}}function a(e){var n=[],t=[];return m()?t=[{regexp:/\*([^\*]+)\*/,replacer:function(e,n){return"%c"+n+"%c"},style:"font-weight:bold;"},{regexp:/_([^_]+)_/,replacer:function(e,n){return"%c"+n+"%c"},style:"font-style:italic;"},{regexp:/`([^`]+)`/,replacer:function(e,n){return"%c"+n+"%c"},style:"background:#FDF6E3; color:#586E75; padding:1px 5px; border-radius:4px;"}]:_()&&(t=[{regexp:/\*([^\*]+)\*/,replacer:function(e,n){return"["+y.modifiers.bold[0]+"m"+n+"["+y.modifiers.bold[1]+"m"}},{regexp:/_([^_]+)_/,replacer:function(e,n){return"["+y.modifiers.italic[0]+"m"+n+"["+y.modifiers.italic[1]+"m"}},{regexp:/`([^`]+)`/,replacer:function(e,n){return"["+y.bgColors.bgYellow[0]+"m["+y.colors.black[0]+"m "+n+" ["+y.colors.black[1]+"m["+y.bgColors.bgYellow[1]+"m"}}]),t.forEach(function(t){var o=e.match(t.regexp);o&&n.push({rule:t,match:o})}),0===n.length?null:(n.sort(function(e,n){return e.match.index-n.match.index}),n[0])}function c(e,n){var t,o=[];return n.opts.prefix?h()?(o.push("%c"+n.opts.prefix+"%c "),o.push("color:"+n.opts.prefixColor+"; font-weight:bold;","")):o.push("["+n.prefix+"] "):o.push(""),"string"==typeof e[0]?n.opts.markdown&&h()?(t=i(e[0]),o[0]=o[0]+t.text,o=o.concat(t.styles)):o[0]=o[0]+e[0]:o[0]=e[0],e.length>1&&(o=o.concat(e.splice(1))),o}function u(e,n,t){var o=[];return t.opts.prefix&&(h()?o[0]="["+t.opts.prefixColor[0]+"m["+y.modifiers.bold[0]+"m"+t.opts.prefix+"["+y.modifiers.bold[1]+"m["+t.opts.prefixColor[1]+"m":o[0]="["+t.opts.prefix+"]"),"warn"===n?o[0]="["+y.colors.yellow[0]+"mâš ["+y.colors.yellow[1]+"m "+(o[0]||""):"error"===n?o[0]="["+y.colors.red[0]+"mâœ–["+y.colors.red[1]+"m "+(o[0]||""):"info"===n?o[0]="["+y.colors.blue[0]+"mâ„¹["+y.colors.blue[1]+"m "+(o[0]||""):"debug"===n&&(o[0]="["+y.colors.gray[0]+"mðŸ›["+y.colors.gray[1]+"m "+(o[0]||"")),e.forEach(function(e){"string"==typeof e&&t.opts.markdown?o.push(i(e).text):o.push(e)}),o}function d(e){var n=!1;return E.forEach(function(t){"enable"===t.type&&t.regExp.test(e.opts.prefix)?n=!1:"disable"===t.type&&t.regExp.test(e.opts.prefix)&&(n=!0)}),n}function l(e){return new RegExp("^"+e.replace(/\*/g,".*?")+"$")}function p(e,n){var t=!1;return n.forEach(function(n){if(n.opts.prefix===e)return void(t=!0)}),t}function f(e,n){var t;return n.forEach(function(n){if(n.opts.prefix===e)return void(t=n)}),t}function g(e){return"string"==typeof e?e.replace(/%c/g,""):e}function h(){if(m()){var e="WebkitAppearance"in document.documentElement.style,t=window.console&&(console.firebug||console.exception&&console.table),o=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;return e||t||o}if(_())return!(n.stdout&&!n.stdout.isTTY)&&("win32"===n.platform||("COLORTERM"in n.env||"dumb"!==n.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.env.TERM)))}function _(){return"undefined"!=typeof e&&"undefined"!=typeof e.exports}function m(){return"undefined"!=typeof window}var b=0,P=["#B58900","#CB4B16","#DC322F","#D33682","#6C71C4","#268BD2","#2AA198","#859900"],y={modifiers:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},colors:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39]},bgColors:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49]}},E=[];t._instances=[],t.enable=function(){Array.prototype.forEach.call(arguments,function(e){"-"===e[0]&&t.disable(e.substr(1));var n=l(e);"*"===e?E=[]:E.push({type:"enable",regExp:n})})},t.disable=function(){Array.prototype.forEach.call(arguments,function(e){"-"===e[0]&&t.enable(e.substr(1));var n=l(e);"*"===e?E=[{type:"disable",regExp:n}]:E.push({type:"disable",regExp:n})})};var v=["debug","log","info","warn","error"];v.forEach(function(e){t.prototype[e]=function(){if(!d(this)){var n,t=Array.prototype.slice.call(arguments,0);m()?(n=c(t,this),Function.prototype.apply.call(console[e]||console.log,console,n)):_()&&(n=u(t,e,this),(console[e]||console.log).apply(console,n))}}});var M=function(){var e=0,n=[[31,39],[32,39],[33,39],[34,39],[35,39],[36,39]];return function(){return e+=1,n[e%n.length]}}();_()?e.exports=t:m()&&(window.Logdown=t)}()}).call(n,t(4))},function(e,n){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(d===setTimeout)return setTimeout(e,0);if((d===t||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(n){try{return d.call(null,e,0)}catch(n){return d.call(this,e,0)}}}function s(e){if(l===clearTimeout)return clearTimeout(e);if((l===o||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(n){try{return l.call(null,e)}catch(n){return l.call(this,e)}}}function i(){h&&f&&(h=!1,f.length?g=f.concat(g):_=-1,g.length&&a())}function a(){if(!h){var e=r(i);h=!0;for(var n=g.length;n;){for(f=g,g=[];++_<n;)f&&f[_].run();_=-1,n=g.length}f=null,h=!1,s(e)}}function c(e,n){this.fun=e,this.array=n}function u(){}var d,l,p=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:t}catch(e){d=t}try{l="function"==typeof clearTimeout?clearTimeout:o}catch(e){l=o}}();var f,g=[],h=!1,_=-1;p.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];g.push(new c(e,n)),1!==g.length||h||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t={MESSENGER_PORT_NAME_PREFIX:"__messenger__",TO_NAME_WILDCARD:"*",BACKGROUND:"background",POPUP:"popup",DEVTOOL:"devtool",CONTENT_SCRIPT:"content_script",INIT:"init",INIT_SUCCESS:"init_success",MESSAGE:"message",RESPONSE:"response"};n.default=t,e.exports=n.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(7),r=t(2),s=t(5),i=500,a=1e5,c=5e3,u=function(e,n,t){r.constructorTweakMethods("Connection",this),this._init(e,n,t)};u.prototype.constructor=u,u.prototype._init=function(e,n,t){switch(this._port=null,this._inited=!1,this._pendingInitMessages=[],this._pendingCb={},this._cbId=0,this._pendingCbCleanupIndex=0,this._myExtPart=e,this._myName=s.MESSENGER_PORT_NAME_PREFIX+n,this._userMessageHandler=t||function(){},this._myExtPart){case s.BACKGROUND:case s.CONTENT_SCRIPT:case s.POPUP:case s.DEVTOOL:var a=function(e){r.log("log","[Connection:_init]","Attempting connection initing..."),this._port=this._myExtPart===s.BACKGROUND?new o({name:this._myName}):chrome.runtime.connect({name:this._myName}),this._port.onMessage.addListener(this._onPortMessageHandler),this._port.postMessage({type:s.INIT,from:this._myExtPart,tabId:e});var n=arguments,t=setTimeout(function(){this._inited?clearTimeout(t):(this._port.disconnect(),a.apply(this,n))}.bind(this),i)}.bind(this);switch(this._myExtPart){case s.BACKGROUND:case s.CONTENT_SCRIPT:a();break;case s.POPUP:chrome.tabs.query({active:!0,currentWindow:!0},function(e){a(e[0].id)});break;case s.DEVTOOL:a(chrome.devtools.inspectedWindow.tabId)}break;default:r.log("error","[Connection:_init]","Unknown extension part: "+e)}},u.prototype._attemptDeadCbCleanup=function(){if(Object.keys(this._pendingCb).length>a){r.log("log","[Connection:_attemptDeadCbCleanup]","Attempting dead callback cleaning... current callbacks number:".Object.keys(this._pendingCb).length);for(var e=this._pendingCbCleanupIndex+c;this._pendingCbCleanupIndex<e;)delete this._pendingCb[this._pendingCbCleanupIndex],this._pendingCbCleanupIndex++;r.log("log","[Connection:_attemptDeadCbCleanup]","New callbacks number after cleaning done:",Object.keys(this._pendingCb).length)}},u.prototype._prepareMessage=function(e,n){var t=this;return new Promise(function(o){switch(n&&(t._cbId++,t._pendingCb[t._cbId]=n,e.cbId=t._cbId,t._attemptDeadCbCleanup()),t._myExtPart){case s.DEVTOOL:e.tabId=chrome.devtools.inspectedWindow.tabId,o();break;case s.POPUP:chrome.tabs.query({active:!0,currentWindow:!0},function(n){e.tabId=n[0].id,o()}.bind(t));break;default:o()}})},u.prototype._postMessage=function(e,n,t){var o=this;this._prepareMessage(n,t).then(function(){o._inited?e.postMessage(n):o._pendingInitMessages.push(n)})},u.prototype._postResponse=function(e,n,t){var o={from:this._myExtPart,to:t.from,toNames:[t.fromName],type:s.RESPONSE,cbId:t.cbId,cbValue:n};this._myExtPart===s.BACKGROUND&&(o.toTabId=t.fromTabId),this._postMessage(e,o)},u.prototype._handleMessage=function(e,n){var t=function(t){e.cbId&&this._postResponse(n,t,e)}.bind(this),o=r.removeMessengerPortNamePrefix(e.fromName),i=e.fromTabId&&e.from!==s.BACKGROUND?":"+e.fromTabId:null,a=e.from+":"+o+(i?":"+i:"");this._userMessageHandler(e.userMessage,a,e.fromPortSender,t)},u.prototype._handleResponse=function(e){if(this._pendingCb[e.cbId]){var n=this._pendingCb[e.cbId];delete this._pendingCb[e.cbId],n(e.cbValue)}else r.log("info","[Connection:_handleResponse]","Ignoring response sending because callback does not exist (probably already been called)")},u.prototype._sendMessage=function(e,n,t,o,r,i){t=this._addMessengerPortNamePrefix(t);var a={from:this._myExtPart,fromName:this._myName,to:n,toNames:t,toTabId:o,type:s.MESSAGE,userMessage:r};this._postMessage(e,a,i)},u.prototype._addMessengerPortNamePrefix=function(e){return e.map(function(e){return e===s.TO_NAME_WILDCARD?e:s.MESSENGER_PORT_NAME_PREFIX+e})},u.prototype._validateMessage=function(e,n,t){if(!e)return'Missing extension part in "to" argument';if(e!==s.BACKGROUND&&e!==s.CONTENT_SCRIPT&&e!==s.DEVTOOL&&e!==s.POPUP)return'Unknown extension part in "to" argument: '+e+"\nSupported parts are: "+s.BACKGROUND+", "+s.CONTENT_SCRIPT+", "+s.POPUP+", "+s.DEVTOOL;if(!n)return'Missing connection name in "to" argument';if(this._myExtPart===s.BACKGROUND&&e!==s.BACKGROUND){if(!t)return'Messages from background to other extension parts must have a tab id in "to" argument';if(!Number.isInteger(parseFloat(t)))return"Tab id to send message to must be a valid number"}},u.prototype._onPortMessageHandler=function(e,n){switch(e.type){case s.INIT_SUCCESS:this._inited=!0,this._pendingInitMessages.forEach(function(e){this._port.postMessage(e)}.bind(this));break;case s.MESSAGE:case s.RESPONSE:e.to||r.log("error","[Connection:_onPortMessageHandler]",'Missing "to" in message: ',e),e.toNames||r.log("error","[Connection:_onPortMessageHandler]",'Missing "toNames" in message: ',e),e.type===s.MESSAGE?this._handleMessage(e,n):e.type===s.RESPONSE&&this._handleResponse(e);break;default:r.log("error","[Connection:_onPortMessageHandler]","Unknown message type: "+e.type)}},u.prototype.sendMessage=function(e,n){var t=this,o=arguments;return new Promise(function(s,i){if(e||r.log("error","[Connection:sendMessage]",'Missing "to" arguments'),!t._port)return r.log("info","[Connection:sendMessage]","Rejecting sendMessage because connection does not exist anymore"),i(new Error("Connection port does not exist anymore, did you disconnect it?"));var a=void 0;try{a=e.split(":")}catch(n){r.log("error","[Connection:sendMessage]",'Invalid format given in "to" argument: '+e,o)}var c=a[0],u=a[1],d=a[2],l=t._validateMessage(c,u,d);l&&r.log("error","[Connection:sendMessage]",l,o);var p=u.split(",");t._sendMessage(t._port,c,p,d,n,s)})},u.prototype.disconnect=function(){this._port&&(this._port.disconnect(),this._port=null)},n.default=u,e.exports=n.default},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(2),r=function(e){o.constructorTweakMethods("MockPort",this);var n=this._createMockPort(e),t=this._createMockPort(e);return this._linkMocks(n,t),"function"==typeof window.mockPortOnConnect&&window.mockPortOnConnect(t),n};r.prototype.constructor=r,r.prototype._createMockPort=function(e){var n={_connected:!0,_name:e.name,onMessageListeners:[],onDisconnectListeners:[]};return Object.defineProperty(n,"name",{get:function(){return n._name}}),Object.defineProperty(n,"onMessage",{get:function(){return{addListener:function(e){n.onMessageListeners.push(e)},removeListener:function(e){var t=n.onMessageListeners.indexOf(e);t!==-1&&n.onMessageListeners.splice(t,1)}}}}),Object.defineProperty(n,"onDisconnect",{get:function(){return{addListener:function(e){n.onDisconnectListeners.push(e)},removeListener:function(e){var t=n.onDisconnectListeners.indexOf(e);t!==-1&&n.onDisconnectListeners.splice(t,1)}}}}),Object.defineProperty(n,"sender",{get:function(){return{id:chrome.runtime.id}}}),n.postMessage=function(e){n._connected?n.__targetRefPort?n.__targetRefPort.__invokeOnMessageHandlers(e):o.log("warn","[MockPort:postMessage]","Missing __targetRefPort",arguments):o.log("warn","[MockPort:postMessage]","Attempting to post message on a disconnected mock port",e)},n.disconnect=function(){n._connected=!1,n.__targetRefPort?n.__targetRefPort.__invokeOnDisconnectHandlers():o.log("warn","[MockPort:postMessage]","Missing __targetRefPort",arguments),n._onMessageListeners=[],n._onDisconnectListeners=[]},n.__invokeOnMessageHandlers=function(e){n.onMessageListeners.forEach(function(t){t(e,n)})},n.__invokeOnDisconnectHandlers=function(){n.onDisconnectListeners.forEach(function(e){e(n)})},n},r.prototype._linkMocks=function(e,n){e.__targetRefPort=n,n.__targetRefPort=e},n.default=r,e.exports=n.default}])});
//# sourceMappingURL=ext-messenger.min.js.map